{% extends 'base.html' %}
{% load static %}
{% block title %}Catálogo - Undersounds{% endblock %}
{% block content %}
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f2f2f2;
        }

        header {
            background-color: #333;
            color: white;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header .logo img {
            height: 40px;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
        }

        main {
            padding: 20px;
        }

        .track-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .track-cover {
            width: 150px;
            height: 150px;
            object-fit: cover;
        }

        .track-details h1 {
            margin: 0;
        }

        .play-button {
            background-color: #ff5500;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }

        .comments-section {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }

        .comments-section h2 {
            margin-bottom: 10px;
        }

.comment {
    background-color: lightgray;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 15px;
    width: 40vw;
    height: auto;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin-right: 20px;
}

.user {
    display: flex;
    align-items: center;
    margin-bottom: 10px; /* Espacio entre la información del usuario y el comentario */
}

.user img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    margin-right: 40px;
}

.come {
    display: flex;
    flex-direction: column; /* Alinea los detalles del comentario verticalmente */
}

.comment p {
    margin: 5px 0;
}

.rating {
    display: flex;
}

.star {
    font-size: 20px;
    color: orange;
    margin-right: 5px;
}

        .author-info, .track-list {
            width: 45%;
        }

        .author-info {
            background-color: #e0e0e0;
            padding: 10px;
            border-radius: 5px;
        }

        .track-list {
            background-color: #e0e0e0;
            padding: 10px;
            border-radius: 5px;
        }

        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px 0;
            position: fixed;
            width: 100%;
            bottom: 0;
        }

        textarea {
            width: 70%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        button {
            padding: 10px 20px;
            margin-top: 10px;
            border: none;
            background-color: #ff5500;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #e64a00;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
        }

        .overlay.active {
            visibility: visible;
        }

        .info-box {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            width: 300px;
        }

        .info-box h2 {
            margin-top: 0;
        }

        .info-box button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            background-color: #ff5500;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .info-box button:hover {
            background-color: #e64a00;
        }

    </style>

<body>
    <main>
        <div id="overlay" class="overlay">
        <div class="info-box">
             <h2>Información</h2>
            <p id="info-text">Este es un cuadro de información.</p>
            <button onclick="window.location.href='../login/'; hideInfoBox();">Sin Usuario</button>
            <button onclick="">Con Usuario</button>
            <button onclick="hideInfoBox()">Cerrar</button>
        </div>
        </div>
        <div id="overlayDesc" class="overlay">
        <div class="info-box">
            <h2>Información</h2>
            <p id="info-text">Este es un cuadro de información.</p>
            <a href="../static/MP3.txt" download="MP3.txt">
                <button>MP3</button>
            </a>
            <a href="../static/FLAC.txt" download="FLAC.txt">
                <button>FLAC</button>
            </a>
            <a href="../static/WAV.txt" download="WAV.txt">
                <button>WAV</button>
            </a>
            <button onclick="hideInfoBoxD()">Cerrar</button>
        </div>
        </div>
        <div id="overlayComent" class="overlay">
        <div class="info-box">
            <h2>Información</h2>
            <p id="info-text">Este es un cuadro de información.</p>
            <button onclick="window.location.href='../login/'; hideInfoBoxC();">Sin Usuario</button>
            <button onclick="addComment()">Con Usuario</button>
            <button onclick="hideInfoBoxC()">Cerrar</button>
        </div>
        </div>
        <button class="back-button" onclick="goBack()">Volver</button>
        <div class="track-info">
            <div class="track-details">
                <h1 id="song-name"></h1>
                <p id="artist-name"></p>
                <p id="album-name"></p>
                <p id="duration"></p>
                <p id="genre"></p>
                <button id="play-button" onclick="showInfoBox()" >Play</button>
                <button id="Desc-button" onclick="showInfoBoxD()" >Descargar</button>
                <button id="like" >Like</button>
            </div>

            <img id="track-cover" class="track-cover" alt="Track Cover">
        </div>
        <button id="Descripcion">Descripcion</button>
        <div class="comments-section">
            <div class="comments">
                <h2>Comments</h2>
                <div id="comments-anadir">
                   <textarea id="new-comment" placeholder="Añadir un comentario..."></textarea>
                <button onclick="showInfoBoxC()">Enviar</button>
                </div>
                <div id="comentarios"></div>

            </div>
            <div class="author-info">
                <h2>Author Information</h2>
                <button id="edit-button" onclick="window.location.href='../artist_detail/';" >Artist</button>
                <img id="author-image" class="author-images" alt="../static/Photos/OIP.jpg" >
                <p><strong>Name:</strong> <span id="author-name"></span></p>
                <p><strong>Genre:</strong> <span id="author-genre"></span></p>
                <div class="track-list">
                    <h1 class="album-title" id="albumTitle"></h1>
                    <ul class="song-list" id="songList"></ul>
                </div>
            </div>
        </div>
    </main>
    <script>
        function goBack() {
            window.history.back();
        }

        function showInfoBox() {
            document.getElementById('overlay').classList.add('active');
        }

        function hideInfoBox() {
            document.getElementById('overlay').classList.remove('active');
        }

        function showInfoBoxD() {
            document.getElementById('overlayDesc').classList.add('active');
        }

        function hideInfoBoxD() {
            document.getElementById('overlayDesc').classList.remove('active');
        }

        function showInfoBoxC() {
            document.getElementById('overlayComent').classList.add('active');
        }

        function hideInfoBoxC() {
            document.getElementById('overlayComent').classList.remove('active');
        }

        const item = JSON.parse(localStorage.getItem('item'));


        if (item) {
            document.getElementById('song-name').textContent = item.song_name;
            document.getElementById('artist-name').textContent = `by ${item.artist_name}`;
            document.getElementById('album-name').textContent = `Album: ${item.album_name}`;
            document.getElementById('duration').textContent = `Duration: ${item.duration}`;
            document.getElementById('genre').textContent = `Genre: ${item.genre}`;
            document.getElementById('track-cover').src = item.album_photo;
            document.getElementById('author-name').textContent = item.artist_name;
            document.getElementById('author-genre').textContent = item.genre;
            document.getElementById('author-image').src = item.artist_photo;
            mostrarComentarios();

            const trackList = document.getElementById('track-list');
            item.tracks.forEach((track, index) => {
                const li = document.createElement('li');
                li.textContent = `${index + 1}. ${track}`;
                trackList.appendChild(li);
            });

            mostrarComentarios();
        } else {
            document.querySelector('.track-info').innerHTML = '<p>No hay datos disponibles.</p>';
        }



        fetch('/static/prueba5.json')
  .then(response => response.json())
  .then(data => {
    const albumName = "Album_B";
    const songsInAlbum = data.filter(song => song.album === albumName);

    document.getElementById('albumTitle').textContent = `Songs from ${albumName}`;
    const songList = document.getElementById('songList');
    songsInAlbum.forEach(song => {
        const listItem = document.createElement('li');
        listItem.textContent = song.title;
        songList.appendChild(listItem);
    });
  })
  .catch(error => console.error('Error loading JSON:', error));








        function mostrarComentarios() {
    const comentariosDiv = document.getElementById('comentarios');
    comentariosDiv.innerHTML = '';

    item.comments.forEach(comment => {
        const commentDiv = document.createElement('div');
        commentDiv.classList.add('comment');

        const userDiv = document.createElement('div');
        userDiv.classList.add('user');

        const img = document.createElement('img');
        img.src = comment.profile_photo;
        img.alt = "Foto de perfil";
        img.onerror = function() {
            img.src = "../static/Photos/OIP.jpg";
        };
        userDiv.appendChild(img);

        const userName = document.createElement('p');
        userName.textContent = `${comment.user_name}`;
        userDiv.appendChild(userName);

        const commentContentDiv = document.createElement('div');
        commentContentDiv.classList.add('come');

        const userComment = document.createElement('p');
        userComment.textContent = `Comentario: ${comment.comment}`;
        commentContentDiv.appendChild(userComment);

        const userRating = document.createElement('div');
        userRating.classList.add('rating');
        for (let i = 1; i <= 5; i++) {
            const star = document.createElement('span');
            star.classList.add('star');
            star.innerHTML = i <= comment.rating ? '★' : '☆';
            userRating.appendChild(star);
        }
        commentContentDiv.appendChild(userRating);

        commentDiv.appendChild(userDiv);
        commentDiv.appendChild(commentContentDiv);
        comentariosDiv.appendChild(commentDiv);
    });
}

        function addComment() {
            const newComment = document.getElementById('new-comment').value;
            const userName = "Nuevo Usuario"; // Puedes cambiar esto para obtener el nombre del usuario actual
            const profilePhoto = "../static/Photos/Users/default.jpg"; // Foto de perfil predeterminada
            const rating = 5; // Puedes cambiar esto para obtener la valoración del usuario

            if (newComment) {
                const comment = {
                    user_name: userName,
                    profile_photo: profilePhoto,
                    comment: newComment,
                    rating: rating
                };

                item.comments.push(comment);
                mostrarComentarios();

                document.getElementById('new-comment').value = '';
            } else {
                alert('Por favor, añade un comentario.');
            }
            hideInfoBoxC();
        }
    </script>
{% endblock %}