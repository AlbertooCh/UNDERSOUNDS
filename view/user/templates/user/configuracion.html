{% extends 'base.html' %}
{% load static %}
{% block title %}Configuración de Cuenta - Undersounds{% endblock %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'user/css/cuenta.css' %}">
{% endblock %}
{% block content %}

<div class="settings-container">
    <h1 class="settings-title">CONFIGURACIÓN DE CUENTA</h1>

    <!-- Sección de Perfil -->
    <div class="settings-section">
        <h2 class="section-title">Perfil Público</h2>

        <div class="avatar-container">
            <img src="{% if user.avatar %}{{ user.avatar.url }}{% else %}{% static 'avatars/usuario.png' %}{% endif %}" alt="Avatar" class="avatar-preview" id="avatarPreview">
            <div class="avatar-upload">
                <form id="avatarForm" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <button type="button" class="btn" style="margin-bottom: 10px;" onclick="document.getElementById('avatarInput').click()">Cambiar Avatar</button>
                    <input type="file" id="avatarInput" name="avatar" class="file-input" accept="image/*" style="display: none;">
                    <p style="font-size: 14px; color: #666;">Formatos: JPG, PNG (Max. 2MB)</p>
                </form>
            </div>
        </div>

        <form id="profileForm" method="post" action="{% url 'update_profile' %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="username">Nombre de Usuario</label>
                <input type="text" id="username" name="username" class="form-control" value="{{ user.username }}" required>
            </div>

            <div class="form-group">
                <label for="bio">Biografía</label>
                <textarea id="bio" name="bio" class="form-control">{{ user.bio|default:"" }}</textarea>
            </div>

            <button type="submit" class="btn">Guardar Cambios</button>
        </form>
    </div>

    <!-- Sección de Seguridad -->
    <div class="settings-section">
        <h2 class="section-title">Cambiar Contraseña</h2>

        <form id="passwordForm" method="post" action="{% url 'change_password' %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="current_password">Contraseña Actual</label>
                <div class="password-field-container">
                    <input type="password" id="current_password" name="current_password" class="form-control" required>
                    <button type="button" class="password-toggle" id="toggle-current-password">
                        <img src="{% static 'images/ver_oculto.png' %}" alt="Mostrar contraseña" id="current-password-icon">
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="new_password">Nueva Contraseña</label>
                <div class="password-field-container">
                    <input type="password" id="new_password" name="new_password" class="form-control" required minlength="8">
                    <button type="button" class="password-toggle" id="toggle-new-password">
                        <img src="{% static 'images/ver_oculto.png' %}" alt="Mostrar contraseña" id="new-password-icon">
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="confirm_password">Confirmar Nueva Contraseña</label>
                <div class="password-field-container">
                    <input type="password" id="confirm_password" name="confirm_password" class="form-control" required minlength="8">
                    <button type="button" class="password-toggle" id="toggle-confirm-password">
                        <img src="{% static 'images/ver_oculto.png' %}" alt="Mostrar contraseña" id="confirm-password-icon">
                    </button>
                </div>
                <div id="password-error" class="error-message" style="display: none;">Las contraseñas no coinciden</div>
            </div>

            <button type="submit" class="btn" id="change-password-btn">Cambiar Contraseña</button>
        </form>
    </div>

    <!-- Zona de Peligro -->
    <div class="settings-section danger-zone">
        <h2 class="section-title" style="color: #ff4d4d;">Zona de Peligro</h2>
        <div class="form-group">
            <p style="margin-bottom: 20px;">Estas acciones son permanentes y no se pueden deshacer.</p>
            <button class="btn danger-btn" id="deactivate-btn">Desactivar Cuenta</button>
            <button class="btn danger-btn" style="margin-top: 10px;" id="delete-btn">Eliminar Cuenta Permanentemente</button>
        </div>
    </div>
</div>

<script src="{% static 'user/js/configuracion.js' %}"></script>
{% endblock %}